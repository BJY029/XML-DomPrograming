import java.awt.EventQueue;
import java.awt.Font;

import javax.swing.JButton;
import javax.swing.JComboBox;
import javax.swing.JFrame;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JScrollPane;
import javax.swing.JTextField;
import javax.swing.JTree;
import javax.swing.SwingConstants;
import javax.swing.SwingUtilities;
import javax.swing.event.TreeSelectionEvent;
import javax.swing.event.TreeSelectionListener;
import javax.swing.tree.DefaultMutableTreeNode;
import javax.swing.tree.DefaultTreeModel;
import javax.swing.tree.TreePath;

import org.w3c.dom.Node;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;

public class DeleteFrame {

	private JFrame frame;
	private JTree tree;
	private JButton DeleteButton;
	private Node selectedNode;

	public void setVisible(boolean b) {
		frame.setVisible(b);
	}

	public void returnToMain() {
		SwingUtilities.invokeLater(() -> {
			JFrame toClose = this.frame; // 닫을 대상 보관
			MainFrame main = new MainFrame();
			main.setVisible(true); // 새 메인 띄우기
			if (toClose != null)
				toClose.dispose(); // 반드시 명시적으로 닫기
		});
	}
	
	public DeleteFrame() {
		initialize();
	}
	
	private void initialize() {
		frame = new JFrame();
		frame.setBounds(100, 100, 573, 750);
		frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		frame.getContentPane().setLayout(null);

		if (!FileData.isLoaded()) {
			JOptionPane.showMessageDialog(null, "No files have been loaded, please load the files first.", "ERROR",
					JOptionPane.ERROR_MESSAGE);
			returnToMain();
			return;
		}

		JLabel DeleteLabel = new JLabel("Delete");
		DeleteLabel.setFont(new Font("굴림", Font.PLAIN, 24));
		DeleteLabel.setHorizontalAlignment(SwingConstants.CENTER);
		DeleteLabel.setBounds(12, 10, 535, 45);
		frame.getContentPane().add(DeleteLabel);

		JScrollPane scrollPane = new JScrollPane();
		scrollPane.setBounds(12, 65, 535, 582);
		frame.getContentPane().add(scrollPane);

		JLabel DeletingLabel = new JLabel("Select the node to delete");
		DeletingLabel.setFont(new Font("굴림", Font.PLAIN, 20));
		DeletingLabel.setHorizontalAlignment(SwingConstants.CENTER);
		scrollPane.setColumnHeaderView(DeletingLabel);

		DefaultMutableTreeNode rootNode = DOMTreeBuilder.buildTree(FileData.document.getDocumentElement());
		tree = new JTree(rootNode);
		scrollPane.setViewportView(tree);
		tree.addTreeSelectionListener(new TreeSelectionListener() {
			@Override
			public void valueChanged(TreeSelectionEvent e) {
				InitAll();
				TreePath path = tree.getSelectionPath();
				if (path == null)
					return;

				DefaultMutableTreeNode selectedTreeNode = (DefaultMutableTreeNode) path.getLastPathComponent();
				Object userObject = selectedTreeNode.getUserObject();

				if (userObject instanceof Node) {
					//System.out.println("event activated");
					Node getNode = (Node) userObject;

					selectedNode = getNode;

				}
			}

		});

		JButton UpdateBtn = new JButton("Update");
		UpdateBtn.setFont(new Font("굴림", Font.PLAIN, 20));
		UpdateBtn.setBounds(12, 657, 127, 45);
		UpdateBtn.addActionListener(e -> UpdateJTree());
		frame.getContentPane().add(UpdateBtn);
		
		DeleteButton = new JButton("Delete");
		DeleteButton.setEnabled(false);
		DeleteButton.setFont(new Font("굴림", Font.PLAIN, 20));
		//DeleteButton.addActionListener(e -> ModifyNode());
		DeleteButton.setBounds(216, 657, 127, 45);

		frame.getContentPane().add(DeleteButton);
		frame.setLocationRelativeTo(null);

		JButton finBtn = new JButton("Back to main");
		finBtn.setFont(new Font("굴림", Font.PLAIN, 18));
		finBtn.setBounds(385, 657, 162, 45);
		finBtn.addActionListener(e -> returnToMain());
		frame.getContentPane().add(finBtn);
		

		

	}
	
	private void UpdateJTree() {
		DefaultMutableTreeNode rootNode = DOMTreeBuilder.buildTree(FileData.document.getDocumentElement());
		DefaultTreeModel model = new DefaultTreeModel(rootNode);
		tree.setModel(model);
	}
	
	private void InitAll() {
		selectedNode = null;

	    
		DeleteButton.setEnabled(false);
	}
}
